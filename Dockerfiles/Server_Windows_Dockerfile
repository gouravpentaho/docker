FROM openjdk:8-jre-windowsservercore
LABEL MAINTAINER Gourav Mudgal

ENV CATALINA_HOME=c:\\pentaho\\server\\pentaho-server\\tomcat

SHELL ["powershell", "-Command", "$ErrorActionPreference = 'Stop'; $ProgressPreference = 'SilentlyContinue';"]

RUN wget http://build.pentaho.net/hosted/9.2.0.0/290/pentaho-server-ee-9.2.0.0-290-dist.zip -OutFile c:\pentaho-server-ee-9.2.0.0-290-dist.zip ; \
    Expand-Archive -Path c:\pentaho-server-ee-9.2.0.0-290-dist.zip -DestinationPath c:\ ; \
    Remove-Item c:\pentaho-server-ee-9.2.0.0-290-dist.zip -Force;

RUN mkdir c:\pentaho\server; \
    java -DINSTALL_PATH=c:\pentaho\server\ -DEULA_ACCEPT=true -jar c:\pentaho-server-ee-9.2.0.0-290\installer.jar -options-system ; \
    Remove-Item 'c:\pentaho-server-ee-9.2.0.0-290' -Recurse;

WORKDIR c:\\pentaho\\server

CMD ["c:\\pentaho\\server\\pentaho-server\\tomcat\\bin\\catalina.bat", "run"]